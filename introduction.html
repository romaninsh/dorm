<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Introduction - DORM - The Dry ORM</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DORM - The Dry ORM</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Welcome to this Book on DORM. Before we dive in, few assumptions:</p>
<ul>
<li>You have read the Introduction (README): <a href="https://github.com/romaninsh/dorm">https://github.com/romaninsh/dorm</a></li>
<li>You have cloned this repository, installed postgres and ran <code>0-intro</code> example.</li>
<li>You have interest in software development efficiency, safety and maintainability.</li>
<li>You have a bit of patience to get to the bottom of various components of DORM as they are explained.</li>
<li>You might need some Rust experience, but I'll try to provide pointers and keep things simple.</li>
</ul>
<p>To get us on the same page, I'll need to go over a basic principles of enterprise software
requirements. Those won't apply to majority of Rust projects, but they are crucial
in commercial software development.</p>
<p>If you are familiar with the concepts (such as from work by Martin Fowler or Eric Evans),
you can skip this section.</p>
<h2 id="the-purpose-of-separation-of-concerns-and-complexity-abstraction"><a class="header" href="#the-purpose-of-separation-of-concerns-and-complexity-abstraction">The Purpose of separation of concerns and complexity abstraction</a></h2>
<p>Terms <code>concern separation</code> and <code>complexity abstraction</code> may be new to you, so I'm going to
look at the enterprise software more generally and also explain why languages such as Java,
C# and TypeScript are considered suitable, while Rust so far had no traction.</p>
<p>Majority of code for the enterprise is designed to "codify" business logic. As company
grows, business rules become more complex. When you open a bank account, you can choose
from few account types, but under the hood banks have hundreds of legacy account types.
A lot of hidden use-cases are needed for regulations or to support legacy systems.</p>
<p>In order to keep the code maintainable, old code must be pruned without affecting stability
of remaining code. Refactoring will always face resistance from product leads, who prefer
rolling out new features.</p>
<p>Companies prefer systems and frameworks which are more modular and easier to maintain.
In many cases, developers who originally wrote the code would no longer be with the company
and a lot of code is written by junior developers too.</p>
<h3 id="separation-of-concerns"><a class="header" href="#separation-of-concerns">Separation of Concerns</a></h3>
<p>Within your average product team (say - 20 developers) engineers who share the code, engineers
would find preference towards a certain sub-sections of your app. Some developers may prefer
working on the "order processing" while others will dive into "onboarding" flow. Those are
called areas of concern. The practice of separating those areas is called SoC - Separation of Concerns.</p>
<p>Rust generally relies on sub-crates to separate concerns, but there is one area, where
those areas intersect - and that is the "persistence layer".</p>
<h3 id="persistence-layer"><a class="header" href="#persistence-layer">Persistence layer</a></h3>
<p>As a business software is dealing with events - it needs to store it's state. Data needs
to persist between execution as well as propogate between containers. Business software
is state-less - when request comes in, the data is loaded, processed and stored back.</p>
<p>Request can come in from an API interface or event queue. Similarly data can be loaded/stored
from Database, APIs or Caches.</p>
<p>It is quite common that in order to process a single request the data would need to be loaded
and stored several times. Quite often external API would rely on intermediate APIs (middleware)
to achieve the task.</p>
<h3 id="idempotence"><a class="header" href="#idempotence">Idempotence</a></h3>
<p>Any request can fail. It can fail before any data is loaded or it can fail after the data
is processed and stored. Idempotence is a design pattern that ensures that any requset can
be retried by the caller. If the original request was successful, retry will also be successful,
but it will not cause any duplicates. This is called Retry safety.</p>
<p>To give you an example, request to send payment of $10 should not send a total of $20 if
it is "retried" due to communication issue inside a middleware.</p>
<h3 id="complexity-abstraction"><a class="header" href="#complexity-abstraction">Complexity Abstraction</a></h3>
<p>I have just went through some of the essential design principles of enterprise software systems.
If this is new to you, it may sound excessively complex.</p>
<p>Well, there is another trick we use in enterprise system and it is complexity abstraction.
An application can be built in layers, where each layer hides complexity.</p>
<p>In fact - when you were going through the <code>introduction</code> code, you have experienced
complexity abstraction first hand. You saw a simple and readable code, that was hiding
complexity through abstraction.</p>
<p>Rust is a complex language. Rust also does not provide any obvious way to implement
complexity abstraction.</p>
<p>DORM has a ready-to-use way to do this in a consistent way - for instance SoftDelete extension
could provide <code>retry safety</code> for your delete operation.</p>
<h3 id="safety-and-performance"><a class="header" href="#safety-and-performance">Safety and Performance</a></h3>
<p>In my opinion, the most important aspect of enterprise software is safety. As humans
we all make mistakes. Quite often in a pursuit of performance, we sacrifice safety.</p>
<p>A seasoned developer may write a chunk of SQL code that quickly and efficiently
performs a complex aggregation. When junior developer comes in, they may introduce
a serious safety bug just by trying to tweak or replicate this complex SQL code.</p>
<p>DORM offers a way to generate performant SQL code without sacrificing safety.</p>
<h3 id="impact-of-change"><a class="header" href="#impact-of-change">Impact of Change</a></h3>
<p>I've seen many projects which were stuck with a "legacy" data structure because
the codebase was riddled with hardcoded SQL queries. As business logic evolves,
it will require changes in the data structure.</p>
<p>Persistence abstraction of DORM creates a layer for backward-compatibility. Operations
like splitting a table into two tables, moving columns between tables can be
handled without affecting change in business logic.</p>
<h3 id="testability"><a class="header" href="#testability">Testability</a></h3>
<p>It is crucial that business logic is testable. However - quite often the logic only
works when it has access to the data. The <code>integration tests</code> usually provides
test-data to a test-suite. Generally those are slow, they can't track code
coverage and they are hard to debug.</p>
<p>DORM provides a way to test business logic through <code>unit tests</code>. By mocking your
data source, you can focus on the business logic. More importantly you can adopt
<code>test-driven development</code> and create standards for your code with test coverage.
Use of faster <code>unit-tests</code> also reduces your release cycle time - a metric that
companies are actively looking at.</p>
<h2 id="business-appps-with-dorm"><a class="header" href="#business-appps-with-dorm">Business Appps with DORM</a></h2>
<p>DORM addresses many of the challenges of enterprise software development.</p>
<p>Ready to learn how? The answers are coming.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next prefetch" href="1-dataset.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next prefetch" href="1-dataset.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
